{% extends 'layout.html' %}
{% block content %}
<div class="container mt-5">
  <h2>Prospective Properties</h2>
  <form method="post" class="row g-3 mb-4">
    <div class="col-auto">
      <input type="url" name="zillow_url" class="form-control" placeholder="Zillow URL" required>
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-success">Add Prospect</button>
    </div>
  </form>
  <form method="get" class="mb-3">
    <div class="row g-2">
      <div class="col-md-2">
        <input type="text" name="search" class="form-control" placeholder="Address..." value="{{ search }}">
      </div>
      <div class="col-md-1">
        <input type="number" name="min_price" class="form-control" placeholder="Min $" value="{{ min_price }}">
      </div>
      <div class="col-md-1">
        <input type="number" name="max_price" class="form-control" placeholder="Max $" value="{{ max_price }}">
      </div>
      <div class="col-md-1">
        <input type="number" name="min_rent" class="form-control" placeholder="Min Rent" value="{{ min_rent }}">
      </div>
      <div class="col-md-1">
        <input type="number" name="max_rent" class="form-control" placeholder="Max Rent" value="{{ max_rent }}">
      </div>
      <div class="col-md-1">
        <input type="number" name="beds" class="form-control" placeholder="Beds" value="{{ beds }}">
      </div>
      <div class="col-md-1">
        <input type="number" step="0.5" name="baths" class="form-control" placeholder="Baths" value="{{ baths }}">
      </div>
      <div class="col-md-2">
        <button class="btn btn-outline-secondary w-100" type="submit">Filter</button>
      </div>
    </div>
  </form>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Zillow URL</th>
        <th>Address</th>
        <th>Price</th>
        <th>Rent</th>
        <th>Beds</th>
        <th>Baths</th>
        <th>Added</th>
      </tr>
    </thead>
    <tbody>
      {% for prospect in prospects.items %}
      {% set pdata = prospect.data | default('{}') | tojson | loads %}
      <tr>
        <td><a href="{{ prospect.zillow_url }}" target="_blank">Zillow</a></td>
        <td>{{ pdata.address or '—' }}</td>
        <td>{{ pdata.price or '—' }}</td>
        <td>{{ pdata.estimated_rent or '—' }}</td>
        <td>{{ pdata.beds or '—' }}</td>
        <td>{{ pdata.baths or '—' }}</td>
        <td>{{ prospect.created_at.strftime('%Y-%m-%d') }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <nav>
    <ul class="pagination">
      {% if prospects.has_prev %}
        <li class="page-item"><a class="page-link" href="?page={{ prospects.prev_num }}&search={{ search }}">Previous</a></li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Previous</span></li>
      {% endif %}
      <li class="page-item disabled"><span class="page-link">Page {{ prospects.page }} of {{ prospects.pages }}</span></li>
      {% if prospects.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ prospects.next_num }}&search={{ search }}">Next</a></li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Next</span></li>
      {% endif %}
    </ul>
  </nav>
</div>
{% endblock %} 